\documentclass[letterpaper,twocolumn,openany,nodeprecatedcode]{dndbook}

% FIXME: babel, polyglossia 패키지에서 korean 사용 시 에러가 발생. issue #1 참고.
% 해당 이슈 해결 전까지 아래 기능은 사용하지 않음.
% % Use babel or polyglossia to automatically redefine macros for terms
% % Armor Class, Level, etc...
% % Default output is in English; captions are located in lib/dndstring-captions.sty.
% % If no captions exist for a language, English will be used.
% %1. To load a language with babel:
% %	\usepackage[<lang>]{babel}
% %2. To load a language with polyglossia:
% %	\usepackage{polyglossia}
% %	\setdefaultlanguage{<lang>}
% % \usepackage[english]{}
% %\usepackage[italian]{babel}
% % For further options (multilanguage documents, hypenations, language environments...)
% % please refer to babel/polyglossia's documentation.

% 자간 및 줄간격을 위해 kotex 사용 
\usepackage[hangul]{kotex}

% 한글을 지원하는 폰트 설정
\usepackage{fontspec}
\setmainfont{Noto Serif CJK KR}   % 본문에 사용할 세리프 폰트
\setsansfont{Noto Sans CJK KR}    % 스탯 블록 등에 사용할 산세리프 폰트

\usepackage[utf8]{inputenc}
\usepackage[singlelinecheck=false]{caption}
\usepackage{lipsum}
\usepackage{listings}
\usepackage{shortvrb}
\usepackage{stfloats}

\captionsetup[table]{labelformat=empty,font={sf,sc,bf,},skip=0pt}

\MakeShortVerb{|}

\lstset{%
  basicstyle=\ttfamily,
  language=[LaTeX]{TeX},
  breaklines=true,
}

\title{The Dark \LaTeX{} \\
\large dndbook 클래스 사용 예제}
\author{Shoyu Vanilla}
\date{2020/02/23}

\begin{document}

\frontmatter

\maketitle

\tableofcontents

\mainmatter%

\chapter{섹션에 관하여}

\DndDropCapLineKorean{이}{패키지는} 세계에서 가장 뛰어난 롤플레잉 게임의 5번째 판본을 위한 문서를 아름답게 조판하는 것을 돕기 위해 만들어졌습니다. \LaTeX{} 의 기본 섹션 형식을 독자에게 좀 더 친숙한 형태로 조정하는 것으로 시작하겠습니다. 챕터 형식은 위에 보이는 바와 같습니다.


\section{섹션}
챕터는 관련 있는 글의 모임인 섹션으로 나뉩니다.

\subsection{서브 섹션}
독자를 위해 정보를 서브 섹션으로 나눌 수 있습니다.

\subsubsection{서브 서브 섹션}
서브 서브 섹션으로도 나눌 수 있습니다. 이 단계까지는 표제가 본문과 따로 표시됩니다. 하위 단계에서는 표제는 본문 안에 표시됩니다.

\paragraph{패러그래프}
패러그래프는 코어 룰북에서는 거의 쓰이지 않지만 ''일반적인'' 스타일을 선호한다면 사용할 수 있습니다.

\subparagraph{서브 패러그래프}
들여쓰기가 있는 서브 패러그래프 형식은 독자에겐 더 익숙할 겁니다.

\section{특수 섹션}
이 모듈에는 여러 줄로 된 섹션 표제 조판에 도움이 될 만한 함수도 들어 있습니다. 재주(feat)를 위한 |\DndFeatHeader|, 마법 아이템과 함정을 위한 |\DndItemHeader|, 주문을 위한 |\DndSpellHeader| 가 있습니다.

\DndFeatHeader{조판의 종복}[선결조건: \LaTeX{} 배포판]
당신은 당신이 가장 좋아하는 게임 중 하나의 자료를 조판하는 것을 돕는 패키지를 획득했습니다. 당신은 새로운 컨텐츠를 조판할 때 지능 굴림에 이점을 얻습니다. 지능 굴림에 실패할 경우 패키지 웹사이트에 문의할 수 있습니다.

\DndItemHeader{철수의 깃펜}{기타 물건, 희귀 등급}

이 깃펜은 3회 충전되어 있습니다. 당신은 이 깃펜을 들고 행동을 사용해 이 깃펜의 충전 1회를 소모할 수 있습니다. 깃펜은 손에서 뛰어올라 당신이 처한 상황에 적용 가능한 계약서를 작성합니다.

이 깃펜은 매일 새벽 1d3회의 힘을 재충전합니다.

\DndSpellHeader%
  {아름다운 조판}
  {4레벨 환영계}
  {1 행동}
  {5 ft}
  {동작, 물질 (잉크, 양피지. 주문 시전시 소모됨.)}
  {무효화될 때까지}
당신은 얼마나 긴 문구든 아름다운 두루마리로 변환할 수 있습니다. 당신이 볼 수 있는 범위 안의 모든 크리쳐는 지혜 내성을 굴려야 하며 실패 시 주문의 효과가 종료될 때까지 당신에게 매혹당한 상태가 됩니다.

당신에게 매혹된 동안 크리쳐는 두루마리에서 눈을 뗄 수 없고 자신의 의지로 두루마리로부터 떠날 수 없습니다. 크리쳐는 자신의 차례가 끝날 때마다 지혜 내성 굴림을 합니다. 내성 굴림에 성공할 경우 매혹은 풀리게 됩니다.

\section{지도 구역}
지도 구역 함수 |\DndArea| 와 |\DndSubArea| 는 지역에 자동으로 번호를 붙입니다.

\DndArea{홈릿 마을}
이곳은 홈릿 마을입니다.

\DndSubArea{환영하는 여자 여관}
마을에는 환영하는 여자 여관이 있습니다.

\DndSubArea{대장장이의 대장간}
마을에는 대장장이도 있습니다.

\DndArea{철수의 성}
이곳은 철수의 집으로, 진흙과 나뭇가지로 된 오두막입니다.

\DndSubArea{해자}
이 도랑에는 널빤지가 가로놓여 있습니다.

\DndSubArea{입구}
5 피트 너비의 구멍으로 흙바닥이 보입니다. 바닥은 지붕에 난 구멍으로부터 빛을 받고 있습니다.

\chapter{텍스트 박스}

이 모듈은 독자의 주의를 끌기 위해 글을 따로 분리할 세 가지 환경을 제공합니다. |DndReadAloud| 는 마스터가 읽어줄 글에 사용합니다.

\begin{DndReadAloud}
  여러분이 이 모듈에 다가가자 모듈을 만들기 위해 수세대에 걸친 피와 눈물이 들어갔다는 느낌이 듭니다. 여러분이 첫 단어를 입력하자 따스한 기분이 여러분을 반깁니다. 
\end{DndReadAloud}

\section{그나저나}
나머지 두 환경은 |DndComment| 와 |DndSidebar| 입니다. |DndComment| 는 분리 가능하며 본문 안에 들어가도 안전합니다.

\begin{DndComment}{이것은 코멘트 박스입니다!}
  |DndComment| 는 글을 강조하는 간단한 박스입니다. |DndSidebar| 에 있는 장식은 없지만 단에 의한 분리를 처리할 수 있습니다.
\end{DndComment}

|DndSidebar| 는 분리 불가능하고 아래와 같이 페이지 구석에 띄우는 것이 가장 좋습니다.

\begin{DndSidebar}[float=!b]{DndSidebar를 보라!}
  |DndSidebar| 는 사이드바로 쓰입니다. 단에 의해 나뉘지 않으며, 페이지 구석에서 그림 환경을 띄우고 주변 본문이 그 주위로 배치될 때 가장 좋습니다.
\end{DndSidebar}

\section{표}
|DndTable| 는 짝수 열에 색을 칠하고 줄 길이만큼의 너비를 갖도록 기본 설정되어 있습니다.

\begin{DndTable}[header=멋진 표]{XX}
    \textbf{제목}  & \textbf{제목} \\
    어떤 값  & 어떤 값 \\
    어떤 값  & 어떤 값 \\
    어떤 값  & 어떤 값
\end{DndTable}

\chapter{몬스터와 NPC}

% Monster stat block
\begin{DndMonster}[float*=b,width=\textwidth + 8pt]{몬스터 철수}
  \begin{multicols}{2}
    \DndMonsterType{중형 기괴체 (메타 문법 변수), 중립 악}

    % If you want to use commas in the key values, enclose the values in braces.
    \DndMonsterBasics[
        armor-class = {9 (\emph{마법 갑주Mage Armor} 사용 시 12)},
        hit-points  = {\DndDice{3d8 + 3}},
        speed       = {30ft, 비행 30ft},
      ]

    \DndMonsterAbilityScores[
        str = 12,
        dex = 8,
        con = 13,
        int = 10,
        wis = 14,
        cha = 15,
      ]

    \DndMonsterDetails[
        %saving-throws = {Str +0, Dex +0, Con +0, Int +0, Wis +0, Cha +0},
        %skills = {Acrobatics +0, Animal Handling +0, Arcana +0, Athletics +0, Deception +0, History +0, Insight +0, Intimidation +0, Investigation +0, Medicine +0, Nature +0, Perception +0, Performance +0, Persuasion +0, Religion +0, Sleight of Hand +0, Stealth +0, Survival +0},
        %damage-vulnerabilities = {cold},
        %damage-resistances = {bludgeoning, piercing, and slashing from nonmagical attacks},
        %damage-immunities = {poison},
        %condition-immunities = {poisoned},
        senses = {암시야 60ft, 상시 감지 10},
        languages = {공용어, 고블린어, 지하 공용어},
        challenge = 1,
      ]
    % Traits
    \DndMonsterAction{선천적 주문시전}
    철수의 선천적 주문시전 능력치는 매력입니다.(주문 내성 DC 12, 주문 명중 +4) 철수는 어떤 구성요소도 사용하지 않고 아래 주문들을 선천적으로 시전할 수 있습니다.
    \begin{DndMonsterSpells}
      \DndInnateSpellLevel{안개 걸음Misty Step}
      \DndInnateSpellLevel[3]{안개 구름Fog Cloud, 로프 속임수Rope Trick}
      \DndInnateSpellLevel[1]{식별Identify}
    \end{DndMonsterSpells}

    \DndMonsterAction{주문시전}
    철수는 2레벨 주문시전자입니다. 철수의 주문시전 능력치는 매력입니다.(주문 내성 DC 12, 주문 명중 +4) 철수는 아래와 같은 소서러 주문들을 준비하고 있습니다.
    \begin{DndMonsterSpells}
      \DndMonsterSpellLevel{도검 방비Blade Ward, 화염 화살Fire Bolt, 빛Light, 전격의 손아귀Shocking Grasp}
      \DndMonsterSpellLevel[1][3]{타오르는 손길Burning Hands, 마법 갑주Mage Armor, 방패Shield}
    \end{DndMonsterSpells}

    \DndMonsterSection{행동}
    \DndMonsterAction{다중공격}
    철수는 근접 공격을 2회 가합니다.

    %Default values are shown commented out
    \DndMonsterAttack[
      name=단검,
      %distance=both, % valid options are in the set {both,melee,ranged},
      %type=weapon, %valid options are in the set {weapon,spell}
      mod=+3,
      %reach=5,
      %range=20/60,
      %targets=one target,
      dmg=\DndDice{1d4+1},
      dmg-type=관통,
      %plus-dmg=,
      %plus-dmg-type=,
      %or-dmg=,
      %or-dmg-when=,
      %extra=,
    ]

    %\DndMonsterMelee calls \DndMonsterAttack with the melee option
    \DndMonsterMelee[
      name=불꽃 혓바닥 장검,
      mod=+3,
      %reach=5,
      %targets=one target,
      dmg=\DndDice{1d8+1},
      dmg-type=참격,
      plus-dmg=\DndDice{2d6},
      plus-dmg-type=화염,
      or-dmg=\DndDice{1d10+1},
      or-dmg-when=양 손으로 근접 공격을 했을 때는
      %extra=,
    ]

    %\DndMonsterRanged calls \DndMonsterAttack with the ranged option
    \DndMonsterRanged[
      name=암살자의 경석궁,
      mod=+1,
      range=80/320,
      dmg=\DndDice{1d8},
      dmg-type=관통,
      %plus-dmg=,
      %plus-dmg-type=,
      %or-dmg=,
      %or-dmg-when=,
      extra={, 목표는 DC 15의 건강 내성 굴림에 실패할 시 24(7d6)점의 독성 피해를 받습니다. 내성에 실패하면 피해가 절반으로 줄어듭니다.}
    ]

    % Legendary Actions
    \DndMonsterSection{전설적 행동}
    철수는 아래 선택지 중에서 3회의 전설적 행동을 취할 수 있습니다. 한번에 오직 하나의 전설적 행동만 할 수 있으며, 다른 크리쳐의 턴이 끝날 때만 전설적 행동을 취할 수 있습니다. 철소는 자기 턴이 시작할 때 소비한 모든 전설적 행동을 회복합니다.

    \begin{DndMonsterLegendaryActions}
      \DndMonsterLegendaryAction{이동}{철수는 자신의 이동 속도만큼 이동합니다.}
      \DndMonsterLegendaryAction{단검 공격}{철수는 단검으로 공격을 가합니다.}
      \DndMonsterLegendaryAction{계약서 작성(행동 3회 소모)}{철수는 자신이 알고 있는 언어로 된 계약서를 10ft 이내의 크리쳐의 얼굴 앞에 내밀어 흔듭니다. 목표가 된 크리쳐는 DC 10의 지능 내성 굴림을 해야 합니다. 실패 시 크리쳐는 철수의 다음 턴이 시작할 때까지 행동불능 상태가 됩니다. 계약서에 적힌 언어를 읽지 못하는 크리쳐는 내성 굴림에 이점을 받습니다.}
    \end{DndMonsterLegendaryActions}
  \end{multicols}
\end{DndMonster}

|DndMonster| 환경은 몬스터와 NPC 스탯 블록을 조판하는 용도입니다. 이 모듈은 스탯 블록 컨텐츠를 쉽게 조판할 수 있는 여러 함수를 제공합니다.

\chapter{색상}

\begin{table*}[b]%
  \caption{}\label{tab:colors}

  \begin{DndTable}[width=\linewidth,header=이 패키지가 지원하는 색상]{lX}
    \textbf{색상}                  & \textbf{설명} \\
    |PhbLightGreen|                 & 플레이어즈 핸드북 1부에 쓰인 밝은 녹색(기본 설정) \\
    |PhbLightCyan|                  & 플레이어즈 핸드북 2부에 쓰인 밝은 청록색 \\
    |PhbMauve|                      & 플레이어즈 핸드북 3부에 쓰인 엷은 보라색 \\
    |PhbTan|                        & 플레이어즈 핸드북 부록에 쓰인 밝은 갈색 \\
    |DmgLavender|                   & 던전 마스터즈 가이드 1부에 쓰인 엷은 보라색 \\
    |DmgCoral|                      & 던전 마스터즈 가이드 2부에 쓰인 코럴색 \\
    |DmgSlateGray| (|DmgSlateGrey|) & 던전 마스터즈 가이드 3부에 쓰인 청회색 \\
    |DmgLilac|                      & 던전 마스터즈 가이드 부록에 쓰인 자회색 \\
  \end{DndTable}
\end{table*}

이 패키지는 |DndComment|, |DndReadAloud|, |DndSidebar|, 및 |DndTable| 환경에 사용할 수 있는 몇가지 전역 색상 변수를 제공합니다.

\begin{DndTable}[header=Box Colors]{lX}
  \textbf{색상}   & \textbf{설명} \\
  |commentcolor|   & |DndComment| 의 배경색 \\
  |readaloudcolor| & |DndReadAloud| 의 배경색 \\
  |sidebarcolor|   & |DndSidebar| 의 배경색 \\
  |tablecolor|     & |DndTable| 의 배경색 및 열 색상 \\
\end{DndTable}

선택적 전달인자를 통해 한 곳에서만 색상을 설정하는 것도 가능합니다. 코어 룰북 강조 색상에 관해서는 표~\ref{tab:colors}를 참고하십시오.

\begin{lstlisting}
\begin{DndTable}[color=PhbLightCyan]{cX}
  \textbf{d8} & \textbf{Item} \\
  1 & Small wooden button \\
  2 & Red feather \\
  3 & Human tooth \\
  4 & Vial of green liquid \\
  6 & Tasty biscuit \\
  7 & Broken axe handle \\
  8 & Tarnished silver locket \\
\end{DndTable}
\end{lstlisting}

\begin{DndTable}[color=PhbLightCyan]{cX}
  \textbf{d8} & \textbf{Item} \\
  1 & Small wooden button \\
  2 & Red feather \\
  3 & Human tooth \\
  4 & Vial of green liquid \\
  6 & Tasty biscuit \\
  7 & Broken axe handle \\
  8 & Tarnished silver locket \\
\end{DndTable}

\section{테마 색상}
|commentcolor|, |readaloudcolor|, |sidebarcolor|, 및 |tablecolor| 를 특정한 색상으로 설정하려면 |\DndSetThemeColor[<color>]| 를 사용하십시오. 전달인자 없이 |\DndSetThemeColor| 를 호출하면 이 색상들이 현재 |themecolor| 가 되도록 설정합니다. 다음 예시에서는 그룹을 통해 몇 개의 박스에만 변경을 제한하는 방법을 소개합니다. 그룹이 끝나는 지점에서 색상은 그룹이 시작하기 전으로 복구됩니다.

\begin{lstlisting}
\begingroup
\DndSetThemeColor[PhbMauve]

\begin{DndComment}{This Comment Is in Mauve}
  This comment is in the the new color.
\end{DndComment}

\begin{DndSidebar}{This Sidebar Is Also Mauve}
  The sidebar is also using the new theme color.
\end{DndSidebar}
\endgroup
\end{lstlisting}

\begingroup
\DndSetThemeColor[PhbMauve]

\begin{DndComment}{This Comment Is in Mauve}
  This comment is in the the new color.
\end{DndComment}

\begin{DndSidebar}{This Sidebar Is Also Mauve}
  The sidebar is also using the new theme color.
\end{DndSidebar}
\endgroup

\end{document}
